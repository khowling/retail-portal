<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title></title>
	<meta name="description" content="">
	<meta name="author" content="">

	<meta name="viewport" content="width=device-width,initial-scale=1">

	<link rel="stylesheet" href="css/style.css"/>
  <link rel="stylesheet" href="css/jquery.jgrowl.css"/>
  <link rel="stylesheet" href="css/jQuizMe.css"/>
  
	<script src="js/libs/modernizr-2.0.6.min.js"> </script>
	<!-- jquery & plugins (addins needs to be included after jquery -->
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script type="text/javascript" src="js/libs/jquery.jgrowl_minimized.js"></script>
	<script type="text/javascript" src="js/libs/jquery.simplemodal.js"></script>
	<script type="text/javascript" src="js/jquery.countup.js"></script>
	<script type="text/javascript" src="js/libs/jQuizMe-2.2.js"></script>
	<script type="text/javascript" src="js/libs/gauge.min.js"></script>
	<script type="text/javascript" src="js/libs/jquery.gauge.min.js"></script>
	
	<link rel="stylesheet" type="text/css" href="css/jRating.jquery.css" media="screen" />
	<script type="text/javascript" src="js/libs/jRating.jquery.js"></script>

	<style>
			ul#quizList {
					-moz-column-count: 2;
					-moz-column-gap: 20px;
					-webkit-column-count: 2; 
					-webkit-column-gap:20px; 
					height: 3in; 
			    font-family: "Lucida Grande", sans-serif;
			    font-size: 14px;
			    line-height: 16px;
			    list-style-type: none;
			    background-color: #FFFFFF;
			}
			.myboarder {
				border-top: 10px solid #DFDBCB; 
				color: white; 
				box-shadow: 0 5px 10px #AAAAAA; 
				padding: 0 5px 5px; 
				background: none repeat scroll 0 0 #6CA128;
			}
			.myboarder-inside {
				background-color: white;
				padding: 2px;
				border-radius: 4px;
				border: 2px solid transparent;
			}
			h3 {
				margin: 5px;
			}
			li {
			  display: list-item;
			}		
			
			li.quiz {
			    position: relative;
			    min-height: 48px;
			    min-width: 48px;
			    -o-break-inside: avoid;         /* multicolumn */
			    -webkit-break-inside: avoid;    /* multicolumn */
			    -moz-break-inside: avoid;       /* multicolumn */
			    break-inside: avoid;            /* multicolumn */
			    padding: 4px 4px 4px 45px;  /* 35px is the left padding for the pic */
			    margin-bottom: 8px;
			    border-radius: 4px;
			    border-bottom: 1px solid #ececec;
			    font-size: 9pt;
			}
			li:hover {
				cursor: pointer;
			  background: #888;
			}
			
			img.quizImage {
				position: absolute;
				top: 0px;
				left: 0px;
				width : 38px;
				border: none;
				margin-top: 2px;
				margin-bottom: 2px;
				margin-left: 2px;
				border-radius: 4px;
				text-overflow: ellipsis;
			}
			div.quizPass {
				float: right;
			}
			
			li.quiz div {
				color: #2276BB;
				text-decoration: none;
			}
			li.quiz div.quizName {
				font-weight: bold;
				margin-right: 0.5em;
				text-overflow: ellipsis;
			}
			li.quiz span.quizHtml {
				color: black;
				padding: 0px;
			}
			
			li.quiz div.quizResults {
				font-size: 11px;
				color: #999;
				line-height: 16px;
				text-overflow: ellipsis;
			}
	</style>

	<script>

		$(document).ready (function(){
				$('#login-content').modal( { close : false});
				$('#points-guage').gauge('init', {
						value: 0,
						valueFormat: function(a,b){return '';},
						label: 'Newbie',
						unitsLabel: '',
						min: 0,
						max: 20000,
						majorTicks: 4,
						minorTicks: 3, // small ticks inside each major tick
						yellowFrom: 5000,
						yellowTo: 15000,
						greenFrom: 15000,
						greenTo: 20000
					});
				return false;
		});

		function launchknowledge (kid, kdata) {
			$("#event-container").empty();
			
			if (kdata.knowledgedata.type == 'EMBEDDED_IFRAME') {
				var _utLayOut = $("<iframe/>").attr({ "width": "100%", "height": "400px", "src": kdata.knowledgedata.url, "frameborder":"0", "allowfullscreen":""});
				$("#event-container").append(_utLayOut);
				$('#basic-modal-content').modal({ 
						close : true,
						onClose: function() {
							$("#event-container").empty();
							$.modal.close();
					}});
				return true;
			}
			
			if (kdata.knowledgedata.type == 'HTML5_VIDEO') {
				var _vLayOut = $("<video/>").attr({"id": "video-container", "width": "100%", "height": "100%", "controls": "controls"}).append( 
					$("<source/>").attr({"src": kdata.knowledgedata.url, "type": "video/mp4"}),
					$("<span/>").text("Your browser does not support the video tag."));
	
				$("#event-container").append(_vLayOut);
				$('#basic-modal-content').modal({ 
						close : true,
						onClose: function() {
							$("#video-container")[0].pause();
							$("#event-container").empty();
							$.modal.close();
					}});
				return true;
			}
			
		}
		function launchquiz (quizid, itemdata) {
			var options = {
				title: itemdata.name,
				intro: '<p>' + itemdata.desc + '</p>' +
				'<p>You receive ' + itemdata.desc + ' points for getting 100% in this Quiz</p>' +
				'<p>REMEBER - Its ONLY your <bold>1st</bold> attempt that get you the points</p>' + 
				'<p>REMEBER - You will still need to get 100% in the quiz to unlock more content (have as many attempts as you need)</p>' + 
				'<p>' + itemdata.intro + '</p>', 
				disableDelete: false,
				disableRestart: true,
				statusUpdate: function( quizInfo, currQuiz ){
						if (quizInfo.deleted == true) {
							$.post( '/donequiz', { id: quizid,  score: quizInfo.score, quesTried: quizInfo.quesTried},
								function( data ) {
										$.modal.close();
								});
						}
			}};
			$("#event-container").empty();
			$("#event-container").jQuizMe( itemdata.quizdata, options );
			$('#basic-modal-content').modal({ close : false});
			return true;
		};
		
		
		var mypoints = 0;
		var lasteventprocessed = 0;		
		var poll_err = false;		
		function poll(){
			if (!poll_err) {
				console.log("creating longpoll request");
				$.ajax({ 
					url: "/longpoll/" + lasteventprocessed, 
					success: function(res){
						if (res.item_type == 'QUIZ' || res.item_type == 'KNOWLEDGE') {
							lasteventprocessed = res.index;

							var itemid = $('#' + res.item_id);
							if (itemid.length == 0) {
								// not on the page, create!
								if (res.item_type == 'QUIZ') {
									itemid = $('#quiz-template').clone().attr({"id": res.item_id }).removeAttr("style").appendTo("#quizList").on('click', function(e) {
										launchquiz (res.item_id, res.item_data);
										 return false;
									}).find(".quizName").text(res.item_data.name).end().find(".quizHtml").text(res.item_data.desc).end();

								} else if (res.item_type == 'KNOWLEDGE') {
									
									if (!res.item_data.icon)  res.item_data.icon = '/image/knowledge-icon.gif';
									itemid = $('#knowledge-template').clone().attr({"id": res.item_id }).removeAttr("style").appendTo("#knowledgeList").on('click', function(e) {
										launchknowledge (res.item_id, res.item_data);
										 return false;
									}).find(".quizName").text(res.item_data.name).end().find(".quizHtml").text(res.item_data.desc).end()
										.find(".quizResults").text(res.item_data.info).end()
										.find(".quizImage").attr({"src": res.item_data.icon}).end()
										.find(".knowRating").jRating({type: "small", isDisabled: true, defaultscore: 40});								
								}
								$.jGrowl("<p>New " + res.item_type + " for you<\p>" + res.item_data.name);
							}
							if (res.item_type == 'QUIZ') {
								if (res.results_data) {
									$(itemid).find(".quizResults").text('attp: ' + res.results_data.attempts + ' | first attempt (best) '+res.results_data.score+'% ('+res.results_data.bestscore+'%)').end();
									if (res.results_data.passed) {
										$(itemid).find(".quizPass").removeAttr("style");
									}
								} else {
									$(itemid).find(".quizResults").text(res.item_data.points + ' points available!').end();
								}
							}
					

							jQuery(function($) {
									$('.timer').countTo({
											from: mypoints,
											to: res.my_points,
											speed: 1000,
											refreshInterval: 10,
											onComplete: function(value) {
													console.debug(this);
											}
									});
							});
							mypoints = res.my_points;
							$('#points-guage').gauge('setValue', mypoints); 
							
						}
					}, 
					error: function(XMLHttpRequest, textStatus, errorThrown){
							poll_err = true;
							$.jGrowl("error: connection with server lost  (" + JSON.stringify(errorThrown) + ")");
						}, 
					dataType: "json", 
					complete: poll, 
					timeout: 60000 
				});
			}
		}
	</script>
	
	
</head>
<body>
	<style>
		#basic-modal-content {display:none;}
		#login-content {display:none;}
	
		/* Overlay */
		#simplemodal-overlay {background-color:#000; cursor:wait;}
		
		/* Container */
		#simplemodal-container {height:420px; width:600px; color:#bbb; background-color:#333; border:4px solid #444; padding:12px;}
		#simplemodal-container .simplemodal-data {padding:8px;}
		#simplemodal-container code {background:#141414; border-left:3px solid #65B43D; color:#bbb; display:block; font-size:12px; margin-bottom:12px; padding:4px 6px 6px;}
		#simplemodal-container a {color:#ddd;}
		#simplemodal-container a.modalCloseImg {background:url(image/lightbox/x.png) no-repeat; width:25px; height:29px; display:inline; z-index:3200; position:absolute; top:-15px; right:-16px; cursor:pointer;}
		#simplemodal-container h3 {color:#84b8d9;}


		.popup-login {
			  font-size: 14px;
				font-weight: bold;
				margin: 0;
				text-shadow: 0 -1px 0 #050505;
    }
		label {
				float: left;
				line-height: 14px;
				margin-top: -4px;
				padding: 8px;
				width: 70px;
		}
		input.modal-text-input {
				background: none repeat scroll 0 0 #FFFFFF;
				border: 2px solid transparent;
				border-radius: 4px 4px 4px 4px;
				color: #555555;
				float: right;
				font-size: 13px;
				padding: 8px;
				width: 200px;
		}
		div.modal-results {
				background: none repeat scroll 0 0 #FFFFFF;
				border: 1px solid transparent;
				border-radius: 4px 4px 4px 4px;
				color: #555555;
				float: right;
				font-size: 16px;
				padding: 8px;
				width: 100px;
		}
		input.modal-button {
				background-color: #459300;
				border: 1px solid transparent;
				border-radius: 4px 4px 4px 4px;
				color: #FFFFFF;
				cursor: pointer;
				float: right;
				font-size: 14px;
				font-weight: bold;
				letter-spacing: 1px;
				padding: 6px 10px;
				text-shadow: 0 -1px 0 #050505;
		}
	</style>
	
	
	<div id="login-content" class="popup-login">
		<script>
			$("#logmein").submit(function(event) {
			
				event.preventDefault(); 
						
				/* get some values from elements on the page: */
				var $form = $( this ),
						un = $form.find( 'input[name="username"]' ).val(),
						url = $form.attr( 'action' );
						if (!un) {
							//alert ('Please enter username');
							 un = 'keith';
						}
				/* Send the data using post and put the results in a div */
				$.post( url, { username: un },
					function( data ) {
						
						
							var _userOut = $("<div/>").append(
								$("<img/>").attr({"src": data.userdata.picture_url, "width": "70%", "height": "70%"}), 
								$("<div/>").attr({"style": "color: black;"}).text(data.username + ' ('+ data.userdata.points +')'));
				
							$("#top-performer").append(_userOut);
			

													
							var _userOut = $("<div/>").append(
								$("<img/>").attr({"src": "/image/carphone_warehouse.jpg", "width": "70%", "height": "70%"}), 
								$("<div/>").attr({"style": "color: black;"}).text("Carphone" + ' '+ "23000" +''));
				
							$("#outlet-leader").append(_userOut);
							
							
							
							
							$.modal.close();
							poll();
					});

			});

		</script>
		<form id="logmein"  action="/login">	
					<h3>Please login to our portal</h3>
					<p>for this demo, no authentication is in place, just use a name to identify yourself this time, and for future access</p>
					</p>
					<p><span id="logerrors"></span></p>
					<p>
						<label>Username</label>
						<input type="text" class="modal-text-input" name="username" value="">
					</p>
					<br style="clear: both;">
					<p>
						<label>Password</label>
						<input type="password" class="modal-text-input" name="password">
					</p>
					<br style="clear: both;">
					<p>
						<input type="submit" value="Sign In" class="modal-button">
					</p>
					
			</form>
	</div>
			
	<!-- modal content -->
	<div id="basic-modal-content">
		
		<div id="eventArea">
			<div id="event-container"></div>
		</div>
		
		<div id="resultsArea"  style="display:none;" class="popup-login">
		<h3>Here are your results, press 'Finish' when your done.</h3>	
			<p>
				<label>number Of Right Answers</label>
				<div id="numOfRight" class="modal-results"></div>
			</p>
			<br style="clear: both;">
			<p>
				<label>number Of Wrong Answers</label>
				<div id="numOfWrong" class="modal-results"></div>
			</p>
			<br style="clear: both;">
			<p>
				<label>Score</label>
				<div id="score" class="modal-results"></div>
			</p>
			<br style="clear: both;">
			<p>
				<label>Total</label>
				<div id="total" class="modal-results"></div>
			</p>
			<br style="clear: both;">
			<br/>
			<p>
				<input id="quiz-return" type="button" value="Return" class="modal-button">
			</p>
		</div>

	</div>

	<!-- preload the images -->
	<div style='display:none'>
		<img src='image/lightbox/x.png' alt='' />
	</div>
		
	

	<div id="header-container">
		<header class="wrapper clearfix">
			<h1 id="title"><img src="/image/NokiaLogo.gif" class="myboarder-inside" style="margin-right: 15px;"/>more engaging learning</h1>
			<nav>
				<ul>
					<li><a href="#">Scan QR</a></li>
					<li><a href="#">Enter Code</a></li>
					<li><a href="#">log issue</a></li>
				</ul>
			</nav>
		</header>
	</div>
	<div id="main-container">
		<div id="main" class="wrapper clearfix">
			
			<article>

				
				<section>
					<div style="overflow: auto;	width: 100%; margin-bottom : 10px;">

						<div class="myboarder" style="float: left; width : 20%; min-width: 80px; height:155px; margin-right: 10px; margin-bottom: 10px;">
							<div style="margin-top: 5px; margin-bottom: 5px; height:35px;">Recommended Training</div>
							<ul id="rec-training" class="myboarder-inside" style="height:100px;" ></ul>
						</div>

						<div class="myboarder" style="float: left; width : 20%; min-width: 80px; height:155px; margin-right: 10px; margin-bottom: 10px;">
							<div style="margin-top: 5px; margin-bottom: 5px; height:35px;">OutLet Leader</div>
							<div id="outlet-leader" class="myboarder-inside" style="height:100px;" ></div>
						</div>

						<div class="myboarder" style="float: left; width : 20%; min-width: 80px; height:155px; margin-right: 10px; margin-bottom: 10px;">
							<div style="margin-top: 5px; margin-bottom: 5px; height:35px;">Top Score</div>
							<ul id="top-performer" class="myboarder-inside" style="align:center; height:100px;" ></ul>
						</div>
						
						<div class="myboarder" style="float: left; width : 20%; min-width: 100px; height:155px; margin-bottom: 10px;">
							<div style="margin-top: 5px; margin-bottom: 5px; height:35px;">My Score <div style="font-weight:bold; float: right;" class="timer"></div></div>
							<canvas id="points-guage" width="110" height="110"></canvas>
						</div>
						
					</div>
					
					<div id="quiz-container" class="myboarder">
						<div>
							<div style="float:left; margin-top: 6px; margin-bottom: 6px;"><h3>Quiz</h3></div>
							<div style="float: right;margin-top: 5px; margin-bottom: 5px;">quizzes appear when something important occures</div>
							<div style="clear: both;"></div>
						</div>
          	<ul id="quizList" class="myboarder-inside">
          		
          		
							<li id="quiz-template" style="display : none;" class="quiz">
								<img class="quizImage" src="/image/quiz_icon.gif"/>
								
								<div class="quizPass" style="display : none;">
									<img style="margin: 10px;" height="40px;" src="/image/pass.gif"></img>
								</div>
								
								<div class="quizName"></div> 
								<span class="quizHtml"></span>
								<br/>
								<div class="quizResults"></div>
							</li>
          	
		        </ul>
		     </div>
		    </section>
				<section>
					<div style="overflow: auto;	width: 100%; margin-bottom : 10px;margin-top : 15px;">
						<div style="float : left; width : 100%;"><spam style="font-weight:bold;">My Trophies</spam> take training - then - complete quizzez. get spot trophies for overachieving.  Thophies means points, points mean ... (we all know what points mean)</div>
					</div>
					
					<div id="trophy-container">

          	<ul id="trophyList" class="myboarder-inside" style="height: 2in; ">
          		
          	</ul>
          </div>
				</section>
				
				<footer>
					
					<p>powered by heroku, nodejs, jquery, mongodb, long polling, and many more</p>
				</footer>
			</article>
			
			<aside>
				
				<div>
							<div style="float:left; margin-top: 6px; margin-bottom: 6px;"><h3>Knowedge</h3></div>
							<div style="float: right; margin-top: 5px; margin-bottom: 5px;"><input type="text" placeholder="search knowledge" class="modal-text-input" name="username" value=""></div>
							<div style="clear: both;"/>
				</div>
				
				<ul id="knowledgeList" class="myboarder-inside" style="background: white; height: 4in; ">
				
						<li id="knowledge-template"  style="display : none;" class="quiz">
								<img class="quizImage" src=""/>
								<div class="quizName"></div> 
								<span class="quizHtml"></span>
								<div style="float: right;">
									<div id="whydoineedaid" class="knowRating" style="margin: 2px;"></div>
									<div style="margin: 2px;">(4234 ratings)</div>
								</div>
								<br/>
								<div class="quizResults"></div>
								
						</li>
				
        </ul>
			</aside>
			
		</div> <!-- #main -->
	</div> <!-- #main-container -->

	<div id="footer-container">
		<footer class="wrapper">
			<h3>footer</h3>
		</footer>
	</div>

</body>
</html>
