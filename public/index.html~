<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title></title>
	<meta name="description" content="">
	<meta name="author" content="">

	<meta name="viewport" content="width=device-width,initial-scale=1">

	<link rel="stylesheet" href="css/style.css"/>
  <link rel="stylesheet" href="css/jquery.jgrowl.css"/>
  <link rel="stylesheet" href="css/jQuizMe.css"/>
  
	<script src="js/libs/modernizr-2.0.6.min.js"> </script>
	<!-- jquery & plugins (addins needs to be included after jquery -->
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script type="text/javascript" src="js/libs/jquery.jgrowl_minimized.js"></script>
	<script type="text/javascript" src="js/libs/jquery.simplemodal.js"></script>
	<script type="text/javascript" src="js/jquery.countup.js"></script>
	<script type="text/javascript" src="js/libs/jQuizMe-2.2.js"></script>
	<script type="text/javascript" src="js/libs/gauge.min.js"></script>
	<script type="text/javascript" src="js/libs/jquery.gauge.min.js"></script>
	<style>
			ul#quizList {
					-moz-column-count: 2;
					-moz-column-gap: 20px;
					-webkit-column-count: 2; 
					-webkit-column-gap:20px; 
					height: 3in; 
			    font-family: "Lucida Grande", sans-serif;
			    font-size: 14px;
			    line-height: 16px;
			    list-style-type: none;
			    background-color: #FFFFFF;
			}
			.myboarder {
				padding: 5px;
				border-radius: 6px;
				border: 3px solid #2276BB;
				margin: 0px;
			}
			#Logo {
				margin-bottom: 5px;
				color: red;
			}
			
			li {
			  display: list-item;
			}		
			
			li.quiz {
			    position: relative;
			    min-height: 48px;
			    min-width: 48px;
			    -o-break-inside: avoid;         /* multicolumn */
			    -webkit-break-inside: avoid;    /* multicolumn */
			    -moz-break-inside: avoid;       /* multicolumn */
			    break-inside: avoid;            /* multicolumn */
			    padding: 4px 4px 4px 45px;  /* 35px is the left padding for the pic */
			    margin-bottom: 8px;
			    border-radius: 4px;
			    border-bottom: 1px solid #ececec;
			    font-size: 9pt;
			}
			li:hover {
				cursor: pointer;
			  background: #888;
			}
			
			img.quizImage {
				position: absolute;
				top: 0px;
				left: 0px;
				width : 38px;
				border: none;
				margin-top: 2px;
				margin-bottom: 2px;
				margin-left: 2px;
				border-radius: 4px;
				text-overflow: ellipsis;
			}

			li.quiz div {
				color: #2276BB;
				text-decoration: none;
			}
			li.quiz div.quizName {
				font-weight: bold;
				margin-right: 0.5em;
				text-overflow: ellipsis;
			}
			
			li.quiz div.quizTime {
				font-size: 11px;
				color: #999;
				line-height: 16px;
				text-overflow: ellipsis;
			}
	</style>

	<script>
		var mypoints = 0;
		var lasteventprocessed = 0;
		
			$(document).ready (function(){
					$('#login-content').modal( { close : false});
					$('#points-guage').gauge('init', {
							value: 0,
							valueFormat: function(a,b){return '';},
							label: 'Newbie',
							unitsLabel: '',
							min: 0,
							max: 20000,
							majorTicks: 4,
							minorTicks: 3, // small ticks inside each major tick
							yellowFrom: 5000,
							yellowTo: 15000,
							greenFrom: 15000,
							greenTo: 20000
						});
					return false;
			});

		function launchquiz (quizdata) {
			 
			var options = {
				intro : "Welcome to your First Exam, when your are ready, press begin quiz", 
				title : "Knowledge Portal",
				disableDelete: false,
				disableRestart: true,
				statusUpdate: function( quizInfo, currQuiz ){
						//alert(JSON.stringify(quizInfo));
						if (quizInfo.deleted == true) {
							// KEITH
							$.post( '/donequiz', { 'id': quizdata.id,  'score': quizInfo.score},
								function( data ) {
										$.modal.close();
										// update quiz with completed and score
										//$('#' + 
								});
							
							
							//quizInfo.deleteQuiz();

							//$('#resultsArea').removeAttr('style').find('#quiz-return').on('click', quizInfo.deleteQuiz, function(e) {
							//		$.modal.close();	}).end()
							//			.find("#numOfRight").text(quizInfo.numOfRight).end()
							//			.find("#numOfWrong").text(quizInfo.numOfWrong).end()
							//			.find("#score").text(quizInfo.score).end()
							//			.find("#total").text(quizInfo.total).end();
						}
			}};
		 $("#quiz").jQuizMe( quizdata, options );
		 $('#basic-modal-content').modal({ close : false});
			
		 return false;
		};
		
		
				
				
		function poll(){
				console.log("creating longpoll request");
				$.ajax({ 
					url: "/longpoll/" + lasteventprocessed, 
					success: function(res){
							lasteventprocessed = data.timestamp;
							$('#quiz-template').clone().attr({"id": res.id }).removeAttr("style").appendTo("#quizList").on('click', function(e) {
									launchquiz (res.data.quizdata);
									 return false;
							}).find(".quizName").text(res.data.name).end().find(".quizHtml").text(res.data.desc).end();

							$.jGrowl("<p>New " + res.data.type + " for you<\p>" + res.data.name);
							jQuery(function($) {
									$('.timer').countTo({
											from: mypoints,
											to: mypoints + res.data.points,
											speed: 1000,
											refreshInterval: 10,
											onComplete: function(value) {
													console.debug(this);
											}
									});
							});
							mypoints += res.data.points;
							$('#points-guage').gauge('setValue', mypoints); 
						}, 
					error: function(XMLHttpRequest, textStatus, errorThrown){
							$.jGrowl("error: " + textStatus + " (" + errorThrown + ")");
						}, 
					dataType: "json", 
					complete: poll, 
					timeout: 60000 });
			}
	</script>
	
	
</head>
<body>
	<style>
		#basic-modal-content {display:none;}
		#login-content {display:none;}
	
		/* Overlay */
		#simplemodal-overlay {background-color:#000; cursor:wait;}
		
		/* Container */
		#simplemodal-container {height:420px; width:600px; color:#bbb; background-color:#333; border:4px solid #444; padding:12px;}
		#simplemodal-container .simplemodal-data {padding:8px;}
		#simplemodal-container code {background:#141414; border-left:3px solid #65B43D; color:#bbb; display:block; font-size:12px; margin-bottom:12px; padding:4px 6px 6px;}
		#simplemodal-container a {color:#ddd;}
		#simplemodal-container a.modalCloseImg {background:url(image/lightbox/x.png) no-repeat; width:25px; height:29px; display:inline; z-index:3200; position:absolute; top:-15px; right:-16px; cursor:pointer;}
		#simplemodal-container h3 {color:#84b8d9;}


		.popup-login {
			  font-size: 14px;
				font-weight: bold;
				margin: 0;
				text-shadow: 0 -1px 0 #050505;
    }
		label {
				float: left;
				line-height: 14px;
				margin-top: -4px;
				padding: 8px;
				width: 70px;
		}
		input.modal-text-input {
				background: none repeat scroll 0 0 #FFFFFF;
				border: 1px solid transparent;
				border-radius: 4px 4px 4px 4px;
				color: #555555;
				float: right;
				font-size: 13px;
				padding: 8px;
				width: 200px;
		}
		div.modal-results {
				background: none repeat scroll 0 0 #FFFFFF;
				border: 1px solid transparent;
				border-radius: 4px 4px 4px 4px;
				color: #555555;
				float: right;
				font-size: 16px;
				padding: 8px;
				width: 100px;
		}
		input.modal-button {
				background-color: #459300;
				border: 1px solid transparent;
				border-radius: 4px 4px 4px 4px;
				color: #FFFFFF;
				cursor: pointer;
				float: right;
				font-size: 14px;
				font-weight: bold;
				letter-spacing: 1px;
				padding: 6px 10px;
				text-shadow: 0 -1px 0 #050505;
		}
	</style>
	
	
	<div id="login-content" class="popup-login">
		<script>
			$("#logmein").submit(function(event) {
				/* stop form from submitting normally */
				event.preventDefault(); 
						
				/* get some values from elements on the page: */
				var $form = $( this ),
						un = $form.find( 'input[name="username"]' ).val(),
						url = $form.attr( 'action' );
				if (!un) alert ('Please enter username');
				/* Send the data using post and put the results in a div */
				$.post( url, { username: un },
					function( data ) {
							$.modal.close();
							poll();
					});

			});

		</script>
		<form id="logmein"  action="/login">	
					<h3>Please login to our portal</h3>
					<p>for this demo, no authentication is in place, just use a name to identify yourself this time, and for future access</p>
					</p>
					<p><span id="logerrors"></span></p>
					<p>
						<label>Username</label>
						<input type="text" class="modal-text-input" name="username" value="">
					</p>
					<br style="clear: both;">
					<p>
						<label>Password</label>
						<input type="password" class="modal-text-input" name="password">
					</p>
					<br style="clear: both;">
					<p>
						<input type="submit" value="Sign In" class="modal-button">
					</p>
					
			</form>
	</div>
			
	<!-- modal content -->
	<div id="basic-modal-content">
		
		<div id="quizArea">
			<div id="quiz"></div>
		</div>
		
		<div id="resultsArea"  style="display:none;" class="popup-login">
		<h3>Here are your results, press 'Finish' when your done.</h3>	
			<p>
				<label>number Of Right Answers</label>
				<div id="numOfRight" class="modal-results"></div>
			</p>
			<br style="clear: both;">
			<p>
				<label>number Of Wrong Answers</label>
				<div id="numOfWrong" class="modal-results"></div>
			</p>
			<br style="clear: both;">
			<p>
				<label>Score</label>
				<div id="score" class="modal-results"></div>
			</p>
			<br style="clear: both;">
			<p>
				<label>Total</label>
				<div id="total" class="modal-results"></div>
			</p>
			<br style="clear: both;">
			<br/>
			<p>
				<input id="quiz-return" type="button" value="Return" class="modal-button">
			</p>
		</div>

	</div>

	<!-- preload the images -->
	<div style='display:none'>
		<img src='image/lightbox/x.png' alt='' />
	</div>
		
	

	<div id="header-container">
		<header class="wrapper clearfix">
			<h1 id="title">making learning more engaging</h1>
			<nav>
				<ul>
					<li><a href="#">how to use</a></li>
					<li><a href="#">log issue</a></li>
					<li><a href="#">new feature</a></li>
				</ul>
			</nav>
		</header>
	</div>
	<div id="main-container">
		<div id="main" class="wrapper clearfix">
			
			<article>
			
				<header id="quiz">
				</header>
				
				<section>
					<div style="overflow: auto;	width: 100%; margin-bottom : 10px;">
						<div style="float : left; width : 74%;"><spam style="font-weight:bold;">My Quiz</spam> quizzes appear when something important occures, for example, a new product launches, you visit a store, your manager thinks you need to learn a new skill, the good thing, you get points for just getting the quiz</div>
						<div class="myboarder" style="float : right; width : 22%;">
							My Score <div style="font-weight:bold; float: right;" class="timer"></div>
							<canvas id="points-guage" width="120" height="120"></canvas>
						</div>
					</div>
					
					<div id="quiz-container">

          	<ul id="quizList" class="myboarder">
          		<div id="Logo">click to take the exam</div>
          		
							<li id="quiz-template" style="display : none;" class="quiz">
								<img class="quizImage" src="/image/quiz_icon.gif"/>
								<div class="quizName" ></div> 
								<span class="quizHtml"></span>
								<br/>
								<div class="quizTime"> attempts 0 | frist attempt 0%</div>
							</li>
          	
		        </ul>
		     </div>
		    </section>
				<section>
					<div style="overflow: auto;	width: 100%; margin-bottom : 10px;margin-top : 15px;">
						<div style="float : left; width : 100%;"><spam style="font-weight:bold;">My Trophies</spam> take training - then - complete quizzez. get spot trophies for overachieving.  Thophies means points, points mean ... (we all know what points mean)</div>
					</div>
					
					<div id="trophy-container">

          	<ul id="trophyList" class="myboarder" style="height: 2in; ">
          		
          	</ul>
          </div>
				</section>
				
				<footer>
					
					<p>powered by heroku, nodejs, jquery, mongodb, long polling, and many more</p>
				</footer>
			</article>
			
			<aside>
				<h3>Knowedge (to help with quiz)</h3>
				<ul id="trophyList" class="myboarder" style="background: white; height: 2in; ">
        </ul>
			</aside>
			
		</div> <!-- #main -->
	</div> <!-- #main-container -->

	<div id="footer-container">
		<footer class="wrapper">
			<h3>footer</h3>
		</footer>
	</div>

</body>
</html>
